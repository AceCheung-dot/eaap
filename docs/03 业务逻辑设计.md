[toc]

* 在微服务架构下，服务的领域模型设计至关重要
  * 消除服务间的对象引用
  * 能够在微服务架构的事务管理约束下工作
* DDD 聚合模式
  * 业务逻辑由一组聚合构成
  * 聚合包含多个对象。聚合中的所有对象是一个单元

## 5.1 业务逻辑模式

* 业务逻辑是六边形架构的核心
* 通过入站适配器和出站适配器，业务逻辑与外部系统进行集成
* **一个服务由业务逻辑和以下适配器组成**
  * [x] REST API Adapter：提供 REST API 的入站适配器
  * [ ] OrderCommandHandlers：提供命令消息 API 的入站适配器
  * [x] Database Adapter：访问数据库的出站适配器
  * [ ] Domain Event Publishing Adapter：往消息代理（Broker）发送事件的出站适配器

<img src="5.1 订单服务的组成.png" style="zoom:50%; float: left;" />

* 相对适配器，业务逻辑的设计要复杂得多

### 事务脚本模式

> **把业务逻辑组织成一组面向过程的事务脚本，每个脚本能够处理一种请求**

* 使用面向过程的思想实现用例
* 把所有的业务逻辑都写到入站端口中
* 适合开发简单逻辑（CRUD）
* 对于复杂逻辑，会导致代码无法复用，此时应使用面向对象设计

<img src="5.2 事务脚本模式.png" style="zoom:50%; float: left;" />

### 领域模型模式

> **业务逻辑由一组具有状态和行为的对象构成**

<img src="images\5.3 领域模型模式.png" style="zoom:50%; float: left;" />

### 使用 DDD 战术模式设计领域模型

* DDD 战术模式把领域模型中的类分为以下几类：
  * 实体（Entity）
  * 值对象（Value Object）
  * 工厂（Factory）
  * 资源库（Repository）
  * 服务（Service）
  * 聚合（Aggregate）
* 实体：
* 值对象
* 工厂
* 资源库
* 服务

## 5.2 使用 DDD 聚合模式设计领域模型

* 在传统的OOD设计中，领域模型（类图）是
  * 一组类及其之间的关系
  * 使用包对类进行组织
  * 问题：缺少清晰的边界
* 

## 5.3 发布领域事件

* 领域事件模式 

  > 当一个聚合被创建或着发生重要的状态改变时，该聚合应发布一个领域事件

* 

